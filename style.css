/* --- Google Fonts Import --- */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&family=MedievalSharp&display=swap');

/* --- CSS 변수 (컬러 팔레트) --- */
:root {
    --font-primary: 'Noto Sans KR', sans-serif;
    --font-title: 'MedievalSharp', cursive; 

    --color-bg-darkest: #121212;
    --color-bg-dark: #1a1a1a;
    --color-bg-mid: #2a2a2a;
    --color-bg-light: #383838;

    --color-border: #444444;
    --color-text-primary: #e0e0e0;
    --color-text-secondary: #a0a0a0;
    --color-text-title: #ffffff;

    --color-accent: #8a6d3b;
    --color-accent-hover: #a88d5b;
    --color-magic: #6a85ab;
    --color-health: #ab6a6a;
    --color-stamina: #6aab7d;
    --color-monster-hp: #c97b7b;
    --color-boss-hp: #d9534f;

    /* 맵 타일 컬러 */
    --color-tile-wall: #444;
    --color-tile-floor: #222;
    --color-tile-fog: #000;
    --color-tile-player: #6aab7d; /* 초록색 */
    --color-tile-monster: #ab6a6a; /* 붉은색 */
    --color-tile-monster-aggro: #ff4444;
    --color-tile-event: #8a6d3b; 
    --color-tile-portal: #b19cd9; 
    --color-tile-rift: #ff00ff; 
    --color-tile-monument: #00ffff;
    
    /* 맵 타일 크기 (1:1 비율 보장) */
    --tile-size: 40px;
    --tile-gap: 1px;
    --tile-total-size: calc(var(--tile-size) + var(--tile-gap));
    
    /* 층별 배경색 및 분위기 */
    --floor-1-bg: #1a1a2e; /* 수정동굴 - 어두운 보라빛 */
    --floor-1-wall: #2d2d44;
    --floor-1-floor: #16213e;
    
    --floor-2-bg: #0a0a0a; /* 어둡지만 별빛 - 매우 어두운 검정 */
    --floor-2-wall: #1a1a1a;
    --floor-2-floor: #0f0f0f;
    
    --floor-3-bg: #2d3e2d; /* 순례자의 길 - 녹색 톤 */
    --floor-3-wall: #3d4e3d;
    --floor-3-floor: #1d2e1d;
    
    --floor-4-bg: #2a2a3a; /* 천공의 탑 - 회색 톤 */
    --floor-4-wall: #3a3a4a;
    --floor-4-floor: #1a1a2a;
    
    --floor-5-bg: #3a1a0a; /* 대마경 - 용암/주황 톤 */
    --floor-5-wall: #4a2a1a;
    --floor-5-floor: #2a0a0a;
    
    --floor-6-bg: #0a1a2a; /* 대해 - 파란 톤 */
    --floor-6-wall: #1a2a3a;
    --floor-6-floor: #0a0a1a;
    
    --floor-7-bg: #0a0a0a; /* 암흑대륙/아이스록 - 매우 어두움 */
    --floor-7-wall: #1a1a1a;
    --floor-7-floor: #0f0f0f;
    
    --floor-8-bg: #2a3a2a; /* 여명의 땅 - 밝은 녹색 */
    --floor-8-wall: #3a4a3a;
    --floor-8-floor: #1a2a1a;
    
    --floor-9-bg: #1a0a0a; /* 별무덤 - 어두운 주황 */
    --floor-9-wall: #2a1a0a;
    --floor-9-floor: #0a0000;
    
    --floor-10-bg: #000000; /* 심연의 문 - 완전한 어둠 */
    --floor-10-wall: #0a0a0a;
    --floor-10-floor: #000000; 

    --shadow-small: 0 2px 4px rgba(0, 0, 0, 0.3);
    --shadow-medium: 0 4px 8px rgba(0, 0, 0, 0.5);
    --border-radius: 5px;
}

/* --- 기본 스타일 --- */
body {
    font-family: var(--font-primary);
    background-color: var(--color-bg-darkest);
    background-image: url('https://www.transparenttextures.com/patterns/concrete-wall-2.png');
    color: var(--color-text-primary);
    margin: 0;
    padding: 0;
    line-height: 1.6;
    overflow: hidden;
}

h1, h2, h3, h4, h5 {
    font-family: var(--font-title);
    color: var(--color-text-title);
    margin-top: 0;
    letter-spacing: 1px;
}

/* --- 전투 연출 효과 --- */
@keyframes screenFlash {
    0% { box-shadow: 0 0 25px 15px rgba(255, 255, 200, 0.7); }
    100% { box-shadow: var(--shadow-medium); }
}
@keyframes screenShake {
    0%, 100% { transform: translateX(0); }
    10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
    20%, 40%, 60%, 80% { transform: translateX(5px); }
}
#game-container.effect-flash { animation: screenFlash 0.3s ease-out; }
#game-container.effect-shake { animation: screenShake 0.3s ease-in-out; }
#game-container.effect-boss-hit { animation: screenShake 0.2s ease-in-out; }

/* --- 레이아웃 --- */
#game-container {
    max-width: 1180px;
    margin: 20px auto;
    background: var(--color-bg-dark);
    padding: 25px;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-medium);
    border: 1px solid var(--color-border);
    transition: box-shadow 0.3s;
    max-height: calc(100vh - 40px);
    display: flex;
    flex-direction: column;
}

#game-title {
    text-align: center;
    color: var(--color-accent);
    font-size: 2.5rem;
    margin-bottom: 20px;
    border-bottom: 2px solid var(--color-accent);
    padding-bottom: 10px;
    flex-shrink: 0;
}

/* --- 메인 게임 그리드 레이아웃 --- */
#main-game {
    display: grid;
    grid-template-areas:
        "status main"
        "log    main";
    grid-template-columns: 360px 1fr;
    grid-template-rows: auto 1fr;
    gap: 20px;
    overflow: hidden;
    position: relative;
}

#status-panel {
    grid-area: status;
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid var(--color-border);
    padding: 15px;
    border-radius: var(--border-radius);
    max-height: 460px;
    overflow-y: auto;
    transition: transform 0.24s ease, opacity 0.24s ease;
    z-index: 20;
}

#main-content {
    grid-area: main;
    background: rgba(0, 0, 0, 0.1);
    border: 1px solid var(--color-border);
    padding: 20px;
    border-radius: var(--border-radius);
    overflow-y: auto; 
    grid-row: 1 / span 2;
    max-height: calc(100vh - 150px); 
    position: relative;
}

#log-panel {
    grid-area: log;
    height: 320px;
    display: flex;
    flex-direction: column;
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid var(--color-border);
    padding: 15px;
    border-radius: var(--border-radius);
    transition: transform 0.24s ease, opacity 0.24s ease;
    z-index: 20;
}

#log-panel h3 {
    margin: 0 0 10px 0;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--color-border);
}

#log {
    height: 100%;
    flex-grow: 1;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.3);
    padding: 10px;
    margin: 0;
    border: 1px solid var(--color-border);
    box-shadow: none;
}

.panel-toggle {
    display: none;
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 35;
    width: 42px;
    min-height: 148px;
    padding: 10px 6px;
    font-size: 0.76rem;
    text-align: center;
    border-radius: 10px;
    background: rgba(20, 23, 31, 0.95);
    border: 1px solid rgba(164, 177, 202, 0.5);
    writing-mode: vertical-rl;
    text-orientation: mixed;
    letter-spacing: 0.5px;
}
.panel-toggle-status { left: 4px; }
.panel-toggle-log { right: 4px; }

#main-game.city-map-layout {
    grid-template-areas: "main";
    grid-template-columns: 1fr;
    grid-template-rows: 1fr;
    gap: 0;
}
#main-game.city-map-layout #main-content {
    grid-area: main;
    grid-row: auto;
    width: 100%;
    min-height: calc(100vh - 210px);
    max-height: calc(100vh - 150px);
    overflow: auto;
}
#main-game.city-map-layout #status-panel,
#main-game.city-map-layout #log-panel {
    position: absolute;
    top: 62px;
    bottom: 10px;
    width: min(340px, 33vw);
    max-height: none;
    margin: 0;
    background: linear-gradient(165deg, rgba(16, 17, 23, 0.95), rgba(10, 12, 16, 0.9));
    backdrop-filter: blur(4px);
    box-shadow: 0 10px 32px rgba(0, 0, 0, 0.45);
}
#main-game.city-map-layout #status-panel { left: 52px; }
#main-game.city-map-layout #log-panel {
    right: 52px;
    height: auto;
}
#main-game.city-map-layout #status-panel.collapsed {
    transform: translateX(calc(-100% - 24px));
    opacity: 0.12;
}
#main-game.city-map-layout #log-panel.collapsed {
    transform: translateX(calc(100% + 24px));
    opacity: 0.12;
}
#main-game.city-map-layout .panel-toggle {
    display: block;
}

/* --- [수정] 탐험 화면 (Exploration Screen) 스타일 --- */
#exploration-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    height: 100%;
}

#map-container {
    position: relative;
    border: 2px solid var(--color-border);
    background-color: var(--floor-1-bg, #000);
    padding: 0; /* padding 제거 */
    border-radius: var(--border-radius);
    overflow: hidden; /* 맵이 컨테이너 밖으로 나가는 것을 숨김 */
    width: 100%; /* 가로 꽉 채움 */
    height: 400px; /* 높이 고정 (조절 가능) */
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 0.5s ease; /* 부드러운 전환 */
}

/* 층별 배경색 및 분위기 */
#map-container.floor-1 {
    background-color: var(--floor-1-bg);
    box-shadow: 0 0 20px rgba(138, 43, 226, 0.3); /* 수정동굴 - 보라빛 글로우 */
}

#map-container.floor-2 {
    background-color: var(--floor-2-bg);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.1); /* 별빛 효과 */
}

#map-container.floor-3 {
    background-color: var(--floor-3-bg);
    box-shadow: 0 0 20px rgba(34, 139, 34, 0.2); /* 순례자의 길 - 녹색 */
}

#map-container.floor-4 {
    background-color: var(--floor-4-bg);
    box-shadow: 0 0 20px rgba(128, 128, 128, 0.3); /* 천공의 탑 - 회색 */
}

#map-container.floor-5 {
    background-color: var(--floor-5-bg);
    box-shadow: 0 0 25px rgba(255, 69, 0, 0.4); /* 대마경 - 용암 주황 */
}

#map-container.floor-6 {
    background-color: var(--floor-6-bg);
    box-shadow: 0 0 20px rgba(0, 100, 200, 0.3); /* 대해 - 파란 */
}

#map-container.floor-7 {
    background-color: var(--floor-7-bg);
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.5); /* 암흑대륙 - 어둠 */
}

#map-container.floor-8 {
    background-color: var(--floor-8-bg);
    box-shadow: 0 0 20px rgba(144, 238, 144, 0.3); /* 여명의 땅 - 밝은 녹색 */
}

#map-container.floor-9 {
    background-color: var(--floor-9-bg);
    box-shadow: 0 0 25px rgba(255, 140, 0, 0.4); /* 별무덤 - 주황 */
}

#map-container.floor-10 {
    background-color: var(--floor-10-bg);
    box-shadow: 0 0 30px rgba(255, 0, 0, 0.5); /* 심연의 문 - 붉은 어둠 */
}

/* [수정] 맵 그리드: 움직이는 부분 */
#map-grid {
    display: grid;
    gap: var(--tile-gap);
    background-color: #111;
    position: absolute; /* 절대 위치 */
    top: 50%;  /* 중앙 정렬 기준점 */
    left: 50%;
    /* 초기 transform은 JS에서 설정하지만 기본값 지정 */
    transform: translate(-50%, -50%); 
    transition: transform 0.2s ease-out; /* 부드러운 이동 효과 */
}

/* [신규] 고정된 플레이어 아바타 - 타일과 정확히 1:1 비율 */
#player-fixed {
    position: absolute;
    top: 50%;
    left: 50%;
    width: var(--tile-size);
    height: var(--tile-size);
    transform: translate(-50%, -50%); /* 정확한 중앙 정렬 */
    background-color: var(--color-tile-floor); 
    color: var(--color-tile-player);
    font-weight: bold;
    border: 2px solid var(--color-tile-player); 
    border-radius: 2px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 1.2rem;
    z-index: 100; /* 맵 위에 표시 */
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    box-sizing: border-box; /* border 포함 크기 계산 */
}

/* 개별 타일 스타일 - 타일 크기 통일 */
.tile {
    width: var(--tile-size);
    height: var(--tile-size);
    background-color: var(--color-tile-floor);
    border-radius: 2px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 0.88rem;
    font-weight: 700;
    user-select: none;
    color: #aaa;
    transition: background-color 0.1s;
    box-sizing: border-box; /* padding/border 포함 크기 계산 */
}

.tile.wall { background-color: var(--color-tile-wall); color: #666; }
.tile.floor { background-color: var(--color-tile-floor); }
.tile.fog { background-color: var(--color-tile-fog); color: transparent; cursor: default; }

/* 층별 타일 색상 (기본값보다 우선) */
.floor-1 .tile.wall { background-color: var(--floor-1-wall, #2d2d44); }
.floor-1 .tile.floor { background-color: var(--floor-1-floor, #16213e); }

.floor-2 .tile.wall { background-color: var(--floor-2-wall, #1a1a1a); }
.floor-2 .tile.floor { background-color: var(--floor-2-floor, #0f0f0f); }

.floor-3 .tile.wall { background-color: var(--floor-3-wall, #3d4e3d); }
.floor-3 .tile.floor { background-color: var(--floor-3-floor, #1d2e1d); }

.floor-4 .tile.wall { background-color: var(--floor-4-wall, #3a3a4a); }
.floor-4 .tile.floor { background-color: var(--floor-4-floor, #1a1a2a); }

.floor-5 .tile.wall { background-color: var(--floor-5-wall, #4a2a1a); }
.floor-5 .tile.floor { background-color: var(--floor-5-floor, #2a0a0a); }

.floor-6 .tile.wall { background-color: var(--floor-6-wall, #1a2a3a); }
.floor-6 .tile.floor { background-color: var(--floor-6-floor, #0a0a1a); }

.floor-7 .tile.wall { background-color: var(--floor-7-wall, #1a1a1a); }
.floor-7 .tile.floor { background-color: var(--floor-7-floor, #0f0f0f); }

.floor-8 .tile.wall { background-color: var(--floor-8-wall, #3a4a3a); }
.floor-8 .tile.floor { background-color: var(--floor-8-floor, #1a2a1a); }

.floor-9 .tile.wall { background-color: var(--floor-9-wall, #2a1a0a); }
.floor-9 .tile.floor { background-color: var(--floor-9-floor, #0a0000); }

.floor-10 .tile.wall { background-color: var(--floor-10-wall, #0a0a0a); }
.floor-10 .tile.floor { background-color: var(--floor-10-floor, #000000); }

/* 플레이어 타일은 이제 필요 없지만(고정 아바타 사용), 만약 겹칠 때를 대비해 투명 처리하거나 제거 */
/* .tile.player { ... } -> ui_exploration.js에서 제거함 */

.tile.monster { 
    color: var(--color-tile-monster); 
    font-weight: bold; 
    animation: pulse 2s infinite;
}
.tile.monster-aggro {
    color: var(--color-tile-monster-aggro);
    text-shadow: 0 0 5px var(--color-tile-monster-aggro);
    animation: aggroPulse 1s infinite;
}

.tile.event { color: var(--color-tile-event); font-weight: bold; }
.tile.portal { color: var(--color-tile-portal); font-weight: bold; text-shadow: 0 0 5px var(--color-tile-portal); }
.tile.rift { color: var(--color-tile-rift); font-weight: bold; text-shadow: 0 0 8px var(--color-tile-rift); }
.tile.monument { color: var(--color-tile-monument); font-weight: bold; text-shadow: 0 0 5px var(--color-tile-monument); }
.tile.item { color: #e6cd7a; font-weight: bold; text-shadow: 0 0 5px #e6cd7a; }
.tile.terrain-forest { background: #244029; }
.tile.terrain-water { background: #1d3551; }
.tile.terrain-lava { background: #5a2415; }
.tile.terrain-ice { background: #2d4f63; }
.tile.torch {
    box-shadow: 0 0 8px rgba(255, 195, 80, 0.65);
    border: 1px solid rgba(255, 195, 80, 0.7);
}
.tile.campfire-placement-target {
    outline: 1px dashed rgba(255, 180, 80, 0.9);
    cursor: crosshair;
}

#map-legend {
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
    color: var(--color-text-secondary);
    font-size: 0.85rem;
    margin-top: 4px;
}

#map-legend span {
    background: rgba(0, 0, 0, 0.28);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    padding: 2px 8px;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}
@keyframes aggroPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

/* 이동 컨트롤러 */
#map-controls {
    display: flex;
    gap: 20px;
    margin-top: 10px;
}
.d-pad {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
}
.d-row {
    display: flex;
    gap: 5px;
}
.d-btn {
    width: 56px;
    height: 56px;
    padding: 0;
    text-align: center;
    font-size: 1rem;
    background: var(--color-bg-mid);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    cursor: pointer;
    color: var(--color-text-primary);
}
.d-btn:active {
    background: var(--color-accent);
    transform: scale(0.95);
}
.d-btn.action {
    width: 110px;
    font-size: 1rem;
}

/* 상호작용 알림 */
#interaction-prompt {
    background-color: rgba(0, 0, 0, 0.8);
    border: 1px solid var(--color-accent);
    padding: 10px 20px;
    border-radius: var(--border-radius);
    text-align: center;
    animation: fadeIn 0.3s;
    position: absolute;
    bottom: 20px; /* 위치 조정 */
    left: 50%;
    transform: translateX(-50%);
    z-index: 101;
    width: 80%;
}
#interaction-desc { margin: 0 0 10px 0; color: var(--color-text-title); font-weight: bold;}
#interaction-btn {
    background-color: var(--color-accent);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateX(-50%) translateY(10px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

/* --- 라비기온 인터랙티브 시티 맵 --- */
#menu.city-map-menu {
    display: block;
    gap: 0;
}

.city-map-shell {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.city-map-header {
    border: 1px solid var(--color-border);
    background: linear-gradient(120deg, rgba(30, 30, 35, 0.95), rgba(28, 34, 42, 0.9));
    border-radius: 10px;
    padding: 14px 16px;
}
.city-map-header h3 {
    margin: 0 0 6px 0;
    color: #e9dec8;
    letter-spacing: 0.5px;
}
.city-map-header p {
    margin: 0;
    color: var(--color-text-secondary);
    font-size: 0.92rem;
    line-height: 1.45;
}

.city-map-body {
    display: grid;
    grid-template-columns: minmax(0, 1fr) 300px;
    gap: 14px;
    min-height: 560px;
}

.city-map-viewport {
    position: relative;
    overflow: hidden;
    border-radius: 12px;
    border: 1px solid rgba(224, 208, 170, 0.35);
    background:
        radial-gradient(circle at 20% 15%, rgba(196, 161, 110, 0.16), transparent 30%),
        radial-gradient(circle at 84% 78%, rgba(116, 148, 199, 0.12), transparent 38%),
        linear-gradient(170deg, #191b20, #101114 62%);
    perspective: 1300px;
    cursor: grab;
    min-height: 560px;
}
.city-map-viewport.is-panning,
.city-map-viewport.is-rotating {
    cursor: grabbing;
}

.city-map-camera {
    position: absolute;
    left: 50%;
    top: 50%;
    transform-style: preserve-3d;
    transform-origin: center center;
    will-change: transform;
    transition: transform 0.08s ease-out;
}

.city-map-board {
    position: relative;
    border-radius: 18px;
    border: 1px solid rgba(255, 228, 184, 0.32);
    box-shadow:
        inset 0 0 50px rgba(0, 0, 0, 0.55),
        0 24px 55px rgba(0, 0, 0, 0.5);
    background:
        radial-gradient(circle at 16% 19%, rgba(255, 208, 128, 0.18), transparent 24%),
        radial-gradient(circle at 72% 34%, rgba(72, 170, 162, 0.15), transparent 31%),
        radial-gradient(circle at 63% 75%, rgba(153, 110, 92, 0.17), transparent 35%),
        linear-gradient(140deg, rgba(66, 56, 46, 0.96), rgba(26, 28, 36, 0.96));
}
.city-map-board::before,
.city-map-board::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
}
.city-map-board::before {
    background-image:
        linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
    background-size: 72px 72px;
    border-radius: inherit;
}
.city-map-board::after {
    border-radius: inherit;
    box-shadow: inset 0 0 140px rgba(0, 0, 0, 0.35);
}

.city-map-link {
    position: absolute;
    height: 2px;
    transform-origin: left center;
    background: linear-gradient(to right, rgba(216, 185, 133, 0.72), rgba(216, 185, 133, 0.15));
    box-shadow: 0 0 8px rgba(206, 165, 110, 0.35);
    pointer-events: none;
}
.city-map-link.district {
    background: linear-gradient(to right, rgba(123, 183, 222, 0.7), rgba(123, 183, 222, 0.14));
    box-shadow: 0 0 8px rgba(123, 183, 222, 0.32);
}

.city-map-node {
    position: absolute;
    transform: translate(-50%, -50%);
    width: 156px;
    min-height: 64px;
    border-radius: 12px;
    border: 1px solid rgba(236, 214, 172, 0.42);
    background: linear-gradient(160deg, rgba(46, 45, 54, 0.94), rgba(28, 31, 36, 0.94));
    color: #f2efe8;
    padding: 9px 10px;
    text-align: center;
    line-height: 1.2;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.42);
    transition: transform 0.16s ease, border-color 0.16s ease, box-shadow 0.2s ease, background-color 0.2s ease;
    z-index: 2;
}
.city-map-node:hover,
.city-map-node:focus-visible {
    transform: translate(-50%, -50%) translateY(-3px);
    border-color: #e1bf88;
}
.city-map-node.active {
    border-color: #ffe0ac;
    box-shadow:
        0 0 0 2px rgba(255, 218, 163, 0.25),
        0 12px 24px rgba(0, 0, 0, 0.45);
    background: linear-gradient(160deg, rgba(74, 65, 46, 0.98), rgba(36, 37, 43, 0.98));
}
.city-map-node .city-map-node-label {
    display: block;
    font-size: 0.86rem;
    font-weight: 700;
    letter-spacing: 0.2px;
    color: #f4f2ec;
}
.city-map-node .city-map-node-type {
    display: block;
    margin-top: 6px;
    font-size: 0.72rem;
    color: #c5ccda;
}

.city-map-node.node-portal {
    border-color: rgba(183, 152, 255, 0.6);
    background: linear-gradient(160deg, rgba(63, 47, 84, 0.95), rgba(30, 29, 42, 0.95));
}
.city-map-node.node-shop {
    border-color: rgba(225, 188, 113, 0.58);
}
.city-map-node.node-guild {
    border-color: rgba(115, 186, 133, 0.58);
}
.city-map-node.node-district {
    width: 170px;
    min-height: 58px;
    border-color: rgba(108, 178, 220, 0.56);
    background: linear-gradient(160deg, rgba(35, 61, 78, 0.94), rgba(27, 34, 45, 0.94));
}
.city-map-node.node-utility {
    border-style: dashed;
    border-color: rgba(166, 188, 201, 0.48);
    background: linear-gradient(160deg, rgba(42, 48, 56, 0.92), rgba(29, 30, 35, 0.92));
}

.city-map-info-panel {
    border: 1px solid var(--color-border);
    background: rgba(14, 16, 20, 0.86);
    border-radius: 10px;
    padding: 14px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}
.city-map-current {
    margin: 0;
    font-size: 0.84rem;
    color: #c2ccd8;
    border-left: 3px solid rgba(129, 174, 214, 0.68);
    padding-left: 8px;
}
.city-map-info-title {
    margin: 4px 0 0 0;
    color: #f5e4bf;
    font-size: 1.15rem;
}
.city-map-info-desc {
    margin: 0;
    color: #d7d7d7;
    min-height: 72px;
    font-size: 0.9rem;
    line-height: 1.45;
}
.city-map-go-btn {
    text-align: center;
    background: linear-gradient(145deg, #5d7646, #385035);
    border-color: rgba(146, 196, 121, 0.64);
    color: #f7fff2;
}
.city-map-go-btn:hover {
    background: linear-gradient(145deg, #6d8a51, #44633f);
}

.city-map-camera-readout {
    margin: 4px 0 0 0;
    color: #aeb8c9;
    font-size: 0.8rem;
}

.city-map-camera-controls {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 6px;
}
.city-map-control-btn {
    text-align: center;
    padding: 9px 8px;
    font-size: 0.83rem;
}

.city-map-quick-actions {
    display: grid;
    grid-template-columns: repeat(4, minmax(0, 1fr));
    gap: 8px;
}
.city-map-quick-btn {
    text-align: center;
    min-height: 44px;
    border-left: 2px solid rgba(164, 164, 164, 0.45);
}

/* --- 도시 장소 액션 그리드 --- */
.city-action-section {
    margin-top: 10px;
    border: 1px solid var(--color-border);
    border-radius: 10px;
    padding: 12px;
    background: linear-gradient(165deg, rgba(19, 21, 27, 0.95), rgba(14, 16, 20, 0.93));
}
.city-action-title {
    margin: 0 0 5px 0;
    color: #e8d8bb;
    font-size: 1.08rem;
}
.city-action-desc {
    margin: 0 0 10px 0;
    color: #afbacf;
    font-size: 0.84rem;
}
.city-action-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(185px, 1fr));
    gap: 8px;
}
.city-action-card {
    min-height: 96px;
    padding: 10px;
    text-align: left;
    border-radius: 8px;
    border: 1px solid rgba(149, 165, 189, 0.42);
    background: linear-gradient(160deg, rgba(39, 42, 51, 0.95), rgba(23, 25, 31, 0.96));
}
.city-action-card .city-card-title {
    display: block;
    font-size: 0.86rem;
    font-weight: 700;
    color: #f0f4ff;
    line-height: 1.25;
    word-break: break-word;
}
.city-action-card .city-card-desc {
    display: block;
    margin-top: 6px;
    font-size: 0.76rem;
    color: #afbdd4;
    line-height: 1.35;
}
.city-action-card .city-card-meta {
    display: block;
    margin-top: 7px;
    font-size: 0.74rem;
    color: #d6decf;
}
.city-action-card.buy {
    border-color: rgba(136, 201, 140, 0.55);
}
.city-action-card.sell {
    border-color: rgba(218, 141, 141, 0.56);
}

.city-shop-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}
.city-shop-column {
    border: 1px solid rgba(129, 138, 154, 0.35);
    border-radius: 8px;
    padding: 10px;
    background: rgba(20, 22, 28, 0.85);
}
.city-shop-column-title {
    margin: 0 0 8px 0;
    color: #d9e0f1;
    font-size: 0.95rem;
}
.city-shop-grid {
    max-height: 390px;
    overflow-y: auto;
    padding-right: 2px;
}
.city-grid-empty {
    margin: 0;
    color: #a8b5ca;
    font-style: italic;
    font-size: 0.82rem;
}

/* --- 기존 스타일 --- */
#menu, #combat-menu, #city-locations, #races-list, #inventory-menu, #essences-menu, #spells-menu, #party-menu {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

button {
    font-family: var(--font-primary);
    background: var(--color-bg-mid);
    color: var(--color-text-primary);
    border: 1px solid var(--color-border);
    padding: 12px 15px;
    margin: 0;
    cursor: pointer;
    border-radius: var(--border-radius);
    text-align: left;
    font-weight: 600;
    transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
    font-size: 1rem;
    box-shadow: var(--shadow-small);
}
button:hover {
    background: var(--color-bg-light);
    border-color: var(--color-accent-hover);
    color: #fff;
    transform: translateY(-1px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
}
button:active {
    background: var(--color-accent);
    color: #fff;
    transform: translateY(0);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
}
button:disabled, button.disabled {
    background: var(--color-bg-dark);
    color: var(--color-text-secondary);
    cursor: not-allowed;
    border-color: var(--color-border);
    transform: none;
    box-shadow: none;
}

#combat-menu button { border-left: 3px solid var(--color-accent); }
#combat-menu button:hover { border-left-color: var(--color-health); }
#combat-menu button[onclick*="playerRun"] { border-left-color: var(--color-stamina); }

.status-bars { margin-bottom: 15px; }
.status-bars label {
    font-size: 0.9rem;
    color: var(--color-text-secondary);
    display: block;
    margin-bottom: 5px;
}
.status-bars progress {
    width: 100%;
    height: 18px;
    border-radius: 3px;
    border: 1px solid var(--color-border);
    background: var(--color-bg-light);
    appearance: none;
}
.status-bars progress::-webkit-progress-bar { background: var(--color-bg-light); border-radius: 3px; }
.status-bars progress::-webkit-progress-value { border-radius: 2px; transition: width 0.3s ease; }
.status-bars progress::-moz-progress-bar { border-radius: 2px; transition: width 0.3s ease; }

#player-hp { color: var(--color-health); }
#player-hp::-webkit-progress-value { background-color: var(--color-health); }
#player-hp::-moz-progress-bar { background-color: var(--color-health); }
#player-mp { color: var(--color-magic); }
#player-mp::-webkit-progress-value { background-color: var(--color-magic); }
#player-mp::-moz-progress-bar { background-color: var(--color-magic); }
#player-stamina { color: var(--color-stamina); }
#player-stamina::-webkit-progress-value { background-color: var(--color-stamina); }
#player-stamina::-moz-progress-bar { background-color: var(--color-stamina); }
.status-bars span { font-weight: bold; color: var(--color-text-primary); float: right; font-size: 0.85rem; margin-left: 5px; }

.monster-status-list, .party-status-list { list-style: none; padding: 0; margin: 10px 0 0 0; }
.monster-status-list li, .party-status-list li { margin-bottom: 8px; font-size: 0.9rem; }
.monster-hp-bar, .party-hp-bar {
    width: 60%; height: 12px; margin: 0 5px; vertical-align: middle;
    border-radius: 2px; border: 1px solid var(--color-border); background: var(--color-bg-light); appearance: none;
}
.monster-hp-bar::-webkit-progress-bar, .party-hp-bar::-webkit-progress-bar { background: var(--color-bg-light); border-radius: 2px; }
.monster-hp-bar::-webkit-progress-value { background-color: var(--color-monster-hp); border-radius: 1px; transition: width 0.2s ease; }
.monster-hp-bar::-moz-progress-bar { background-color: var(--color-monster-hp); border-radius: 1px; transition: width 0.2s ease; }
.party-hp-bar::-webkit-progress-value { background-color: var(--color-stamina); border-radius: 1px; transition: width 0.2s ease; }
.party-hp-bar::-moz-progress-bar { background-color: var(--color-stamina); border-radius: 1px; transition: width 0.2s ease; }
.monster-hp-value, .party-hp-value { font-size: 0.8rem; color: var(--color-text-secondary); vertical-align: middle; }

.boss-status-container {
    border: 2px solid var(--color-boss-hp); border-radius: var(--border-radius); padding: 10px; margin-bottom: 15px; background: rgba(0,0,0,0.3);
}
.boss-status-container h4 { margin: 0 0 5px 0; color: var(--color-boss-hp); font-size: 1.3rem; text-align: center; }
#boss-hp-bar { width: 100%; height: 25px; appearance: none; border: 1px solid var(--color-border); border-radius: 3px; background: var(--color-bg-light); }
#boss-hp-bar::-webkit-progress-bar { background: var(--color-bg-light); border-radius: 3px; }
#boss-hp-bar::-webkit-progress-value { background-color: var(--color-boss-hp); border-radius: 2px; transition: width 0.3s ease; box-shadow: 0 0 8px rgba(217, 83, 79, 0.7); }
#boss-hp-bar::-moz-progress-bar { background-color: var(--color-boss-hp); border-radius: 2px; transition: width 0.3s ease; box-shadow: 0 0 8px rgba(217, 83, 79, 0.7); }
#boss-hp-value { display: block; text-align: center; font-weight: bold; font-size: 0.9rem; color: var(--color-text-primary); margin-top: 5px; }

.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.75); display: flex; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(3px);
}
.modal-content {
    background: var(--color-bg-dark); width: 90%; max-width: 700px; max-height: 85vh;
    overflow-y: auto; padding: 25px; border-radius: var(--border-radius);
    box-shadow: var(--shadow-medium); border: 1px solid var(--color-accent); z-index: 1001; margin: 0;
}
#inventory-screen.hidden, #essences-screen.hidden, #spells-screen.hidden, #party-screen.hidden, #quest-log-screen.hidden, #character-status-screen.hidden, #essence-choice-screen.hidden, #rift-choice-screen.hidden {
    display: none !important;
}
.modal-close-btn { margin-top: 20px; background: var(--color-accent); color: white; text-align: center; font-weight: bold; }
.modal-close-btn:hover { background: var(--color-accent-hover); border-color: var(--color-border); }

#character-status-content { margin-top: 10px; }
.character-status-layout {
    display: grid;
    grid-template-columns: minmax(280px, 380px) minmax(0, 1fr);
    gap: 16px;
    align-items: stretch;
}
.paperdoll-wrap {
    border: 1px solid var(--color-border);
    border-radius: 12px;
    padding: 12px;
    background: linear-gradient(160deg, rgba(24, 25, 31, 0.92), rgba(18, 19, 24, 0.9));
}
.paperdoll-stage {
    position: relative;
    min-height: 360px;
    border: 1px solid rgba(148, 154, 168, 0.28);
    border-radius: 10px;
    overflow: hidden;
    background:
        radial-gradient(circle at 50% 30%, rgba(176, 208, 255, 0.08), transparent 42%),
        radial-gradient(circle at 50% 90%, rgba(189, 150, 109, 0.1), transparent 48%),
        linear-gradient(170deg, rgba(22, 24, 29, 0.9), rgba(14, 15, 20, 0.96));
}
.paperdoll-figure {
    position: absolute;
    left: 50%;
    top: 50%;
    width: 136px;
    height: 280px;
    transform: translate(-50%, -50%);
}
.figure-part {
    position: absolute;
    background: linear-gradient(160deg, #7f8898, #4a5160);
    box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.08);
}
.figure-part.head {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    left: 50%;
    top: 0;
    transform: translateX(-50%);
}
.figure-part.torso {
    width: 76px;
    height: 116px;
    border-radius: 18px;
    left: 50%;
    top: 50px;
    transform: translateX(-50%);
}
.figure-part.arm {
    width: 22px;
    height: 112px;
    border-radius: 12px;
    top: 58px;
}
.figure-part.arm.left { left: 16px; transform: rotate(8deg); }
.figure-part.arm.right { right: 16px; transform: rotate(-8deg); }
.figure-part.leg {
    width: 26px;
    height: 110px;
    border-radius: 12px;
    top: 170px;
}
.figure-part.leg.left { left: 44px; }
.figure-part.leg.right { right: 44px; }

.paperdoll-slot {
    position: absolute;
    width: 120px;
    min-height: 48px;
    border-radius: 8px;
    border: 1px solid rgba(162, 174, 194, 0.42);
    background: rgba(34, 38, 46, 0.9);
    padding: 5px 7px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    text-align: center;
}
.paperdoll-slot .slot-name { font-size: 0.74rem; color: #cfd8e8; }
.paperdoll-slot .slot-item {
    font-size: 0.7rem;
    color: #9fa9bd;
    word-break: break-word;
}
.paperdoll-slot.equipped {
    border-color: rgba(147, 204, 146, 0.72);
    background: rgba(32, 53, 35, 0.9);
}
.paperdoll-slot.equipped .slot-item { color: #d8edd5; }
.paperdoll-slot.empty { opacity: 0.8; }
.paperdoll-slot.slot-helmet { left: 50%; top: 14px; transform: translateX(-50%); }
.paperdoll-slot.slot-chest { left: 50%; top: 113px; transform: translateX(-50%); }
.paperdoll-slot.slot-gloves { left: 14px; top: 132px; }
.paperdoll-slot.slot-legs { left: 50%; bottom: 16px; transform: translateX(-50%); }
.paperdoll-slot.slot-weapon { right: 14px; top: 124px; }
.paperdoll-slot.slot-offhand { right: 14px; top: 206px; }

.character-summary {
    margin: 10px 0 0 0;
    text-align: center;
    color: #d7dfef;
    font-size: 0.9rem;
}
.character-slot-list {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
    align-content: start;
}
.character-slot-card {
    border: 1px solid rgba(157, 170, 189, 0.42);
    border-radius: 8px;
    padding: 10px;
    background: rgba(26, 28, 34, 0.92);
}
.character-slot-card.equipped {
    border-color: rgba(143, 200, 143, 0.72);
    background: rgba(29, 43, 32, 0.92);
}
.character-slot-card .slot-card-name { font-size: 0.85rem; color: #dde7ff; }
.character-slot-card .slot-card-item {
    margin-top: 6px;
    font-size: 0.8rem;
    color: #bcc7db;
    word-break: break-word;
}

#inventory-screen .modal-content.inventory-rpg-modal {
    max-width: 1120px;
    width: 96%;
}

.inventory-rpg-layout {
    display: grid;
    grid-template-columns: minmax(210px, 260px) minmax(0, 1fr) minmax(240px, 310px);
    gap: 12px;
    min-height: 520px;
}

.inventory-equip-panel,
.inventory-bag-panel,
.inventory-detail-panel {
    border: 1px solid var(--color-border);
    border-radius: 10px;
    background: rgba(15, 16, 20, 0.86);
    padding: 10px;
}

.inv-panel-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(130, 140, 160, 0.25);
}
.inv-panel-head h3 {
    margin: 0;
    font-size: 1rem;
    color: #e8d8b8;
}
.inv-panel-head span {
    font-size: 0.78rem;
    color: #aab3c4;
}

.inv-equip-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 8px;
}
.inv-equip-slot {
    text-align: left;
    min-height: 66px;
    border-radius: 8px;
    border: 1px solid rgba(151, 161, 178, 0.42);
    background: linear-gradient(160deg, rgba(35, 37, 45, 0.95), rgba(22, 24, 30, 0.95));
    padding: 8px 10px;
}
.inv-equip-slot .slot-label {
    display: block;
    font-size: 0.8rem;
    color: #d8e0ef;
}
.inv-equip-slot .slot-item {
    display: block;
    margin-top: 4px;
    font-size: 0.78rem;
    color: #a9b5cb;
    word-break: break-word;
}
.inv-equip-slot.equipped {
    border-color: rgba(141, 201, 149, 0.7);
    background: linear-gradient(160deg, rgba(37, 58, 41, 0.95), rgba(23, 35, 27, 0.95));
}
.inv-equip-slot.equipped .slot-item {
    color: #dcefd8;
}

.inventory-bag-panel {
    display: flex;
    flex-direction: column;
    min-height: 0;
}
.inv-filter-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 10px;
}
.inv-filter-btn {
    padding: 6px 10px;
    font-size: 0.78rem;
    min-height: 34px;
    border-radius: 999px;
    text-align: center;
    border: 1px solid rgba(130, 145, 171, 0.45);
    background: rgba(40, 46, 58, 0.85);
}
.inv-filter-btn.active {
    border-color: rgba(231, 198, 144, 0.8);
    background: rgba(88, 72, 47, 0.9);
    color: #fff8ee;
}

.inv-item-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
    gap: 8px;
    overflow-y: auto;
    padding-right: 2px;
}
.inv-item-card {
    min-height: 92px;
    text-align: left;
    border-radius: 8px;
    border: 1px solid rgba(150, 163, 186, 0.4);
    background: linear-gradient(160deg, rgba(38, 40, 49, 0.94), rgba(24, 26, 32, 0.94));
    padding: 8px;
    position: relative;
}
.inv-item-card .inv-item-name {
    display: block;
    font-size: 0.78rem;
    color: #f1f5ff;
    line-height: 1.3;
    word-break: break-word;
}
.inv-item-card .inv-item-meta {
    display: block;
    margin-top: 6px;
    font-size: 0.7rem;
    color: #a7b3cb;
}
.inv-item-card .inv-item-count {
    position: absolute;
    right: 8px;
    bottom: 6px;
    font-size: 0.72rem;
    color: #d4dbe8;
}
.inv-item-card.equipment {
    border-color: rgba(214, 177, 105, 0.5);
}
.inv-item-card.consumable {
    border-color: rgba(123, 192, 133, 0.52);
}
.inv-item-card.material {
    border-color: rgba(114, 173, 214, 0.52);
}
.inv-item-card.selected {
    border-color: rgba(255, 228, 182, 0.92);
    box-shadow: 0 0 0 2px rgba(255, 221, 163, 0.22);
    transform: translateY(-1px);
}

.inv-detail-body {
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.inv-detail-title {
    margin: 0;
    color: #efe1c3;
    font-size: 1.05rem;
}
.inv-detail-line {
    margin: 0;
    font-size: 0.82rem;
    color: #d0d8e8;
}
.inv-detail-desc {
    margin: 2px 0 0 0;
    padding: 10px;
    border-radius: 8px;
    background: rgba(30, 33, 40, 0.86);
    border: 1px solid rgba(140, 150, 169, 0.3);
    color: #d7dce8;
    font-size: 0.82rem;
    line-height: 1.45;
    min-height: 110px;
}
.inv-detail-action {
    margin-top: 4px;
    text-align: center;
    font-weight: 700;
    border-color: rgba(195, 160, 103, 0.7);
    background: linear-gradient(160deg, rgba(103, 79, 47, 0.93), rgba(69, 53, 31, 0.93));
}

.inv-empty-guide {
    margin: 6px 0;
    font-size: 0.82rem;
    color: #a8b2c5;
    font-style: italic;
}

/* --- 공통 모달 그리드 카드 --- */
.modal-grid-head {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    border-bottom: 1px solid rgba(146, 158, 180, 0.3);
    padding-bottom: 8px;
}
.modal-grid-head h3 {
    margin: 0;
    font-size: 1.08rem;
    color: #ead8b5;
}
.modal-grid-head span {
    font-size: 0.8rem;
    color: #b1bed5;
}
.modal-grid-section {
    margin-top: 10px;
}
.modal-grid-section h4 {
    margin: 0 0 8px 0;
    color: #d8e2f5;
    font-size: 0.95rem;
}
.modal-card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 10px;
}
.modal-info-card {
    border: 1px solid rgba(150, 163, 186, 0.42);
    border-radius: 9px;
    padding: 10px;
    background: linear-gradient(160deg, rgba(37, 40, 48, 0.94), rgba(22, 24, 31, 0.95));
}
.modal-info-card h4 {
    margin: 0;
    color: #f1f4fd;
    font-size: 0.92rem;
}
.modal-info-card p {
    margin: 7px 0 0 0;
    color: #b9c4da;
    font-size: 0.79rem;
    line-height: 1.4;
}
.modal-info-card .card-meta {
    color: #d7decf;
    font-size: 0.74rem;
}
.modal-empty-text {
    margin: 0;
    color: #a5b2c7;
    font-style: italic;
    font-size: 0.83rem;
}

.essence-card { border-color: rgba(122, 166, 216, 0.5); }
.spell-card { border-color: rgba(137, 177, 226, 0.52); }
.skill-card { border-color: rgba(213, 177, 122, 0.52); }
.party-card-grid { grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); }
.party-member-card { border-color: rgba(139, 196, 148, 0.56); }
.quest-card.active { border-color: rgba(214, 180, 114, 0.56); }
.quest-card.completed {
    border-color: rgba(130, 141, 159, 0.48);
    opacity: 0.86;
}
.quest-objective-list p {
    margin: 5px 0 0 0;
    font-size: 0.78rem;
}

.mini-chip-row {
    margin-top: 8px;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}
.mini-chip {
    display: inline-flex;
    align-items: center;
    padding: 3px 6px;
    border: 1px solid rgba(145, 158, 178, 0.42);
    border-radius: 999px;
    font-size: 0.72rem;
    color: #c8d2e6;
    background: rgba(40, 46, 58, 0.9);
}
.danger-inline-btn {
    margin-top: 10px;
    text-align: center;
    border-color: rgba(215, 130, 130, 0.72);
    background: linear-gradient(160deg, rgba(109, 55, 55, 0.95), rgba(79, 39, 39, 0.95));
}

/* --- 상태 패널 카드형 --- */
.status-chip-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 6px;
    margin-bottom: 10px;
}
.status-chip {
    display: inline-flex;
    align-items: center;
    min-height: 28px;
    padding: 4px 8px;
    border-radius: 999px;
    border: 1px solid rgba(145, 160, 188, 0.45);
    background: rgba(36, 40, 50, 0.9);
    font-size: 0.75rem;
    color: #d6e0f1;
}
.status-inline-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 6px;
    margin-bottom: 10px;
}
.status-inline-card {
    border: 1px solid rgba(138, 151, 174, 0.38);
    border-radius: 8px;
    padding: 7px 8px;
    background: rgba(29, 32, 39, 0.9);
    display: flex;
    justify-content: space-between;
    gap: 8px;
    font-size: 0.78rem;
}
.status-inline-card b { color: #dbe5f7; }
.status-inline-card span { color: #b8c4da; text-align: right; }
.status-section {
    margin-top: 10px;
    border-top: 1px solid rgba(137, 149, 171, 0.28);
    padding-top: 8px;
}
.status-section h4 {
    margin: 0 0 6px 0;
    font-size: 0.9rem;
    color: #e5d5b7;
}
.status-mini-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 6px;
}
.status-mini-card {
    border: 1px solid rgba(136, 150, 173, 0.36);
    border-radius: 7px;
    padding: 6px 7px;
    background: rgba(33, 36, 45, 0.9);
    font-size: 0.75rem;
}
.status-mini-card b {
    display: block;
    color: #dbe6fb;
}
.status-mini-card span {
    display: block;
    margin-top: 2px;
    color: #b7c3db;
}
.status-empty {
    margin: 0;
    font-size: 0.78rem;
    color: #9eabbe;
    font-style: italic;
}

[class^="icon-"] { display: inline-block; margin-right: 8px; font-family: var(--font-title); color: var(--color-accent); }
.icon-user:before { content: "P"; } .icon-combat:before { content: "!"; } .icon-log:before { content: "L"; }
.icon-inventory:before { content: "I"; } .icon-essence:before { content: "E"; } .icon-spell:before { content: "S"; }
.icon-party:before { content: "T"; } .icon-quest:before { content: "Q"; } .icon-map:before { content: "M"; }

.list-item, .stat-item { background: var(--color-bg-mid); padding: 10px; border-radius: var(--border-radius); border-left: 3px solid var(--color-magic); }
.stat-list { list-style: none; padding: 0; display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 5px; }
.stat-item { font-size: 0.85rem; border-left-color: var(--color-border); }
.layer-description, .event-desc, #race-selection p { margin-bottom: 15px; font-style: italic; color: var(--color-text-secondary); border-left: 3px solid var(--color-accent); padding-left: 10px; }

.log-message { margin: 2px 0; padding: 4px 6px; border-radius: 3px; transition: background-color 0.3s, transform 0.2s; font-size: 0.9rem; }
.log-message.combat { color: var(--color-health); font-style: italic; }
.log-message.reward { color: var(--color-stamina); }
.log-message.magic { color: var(--color-magic); }
.log-message.system { color: var(--color-accent); font-weight: bold; }

@keyframes skillPopup {
    0% { transform: scale(0.9) translateY(10px); opacity: 0.5; }
    20% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1.0) translateY(0); }
}
.log-message.log-skill-player {
    font-size: 1.2rem; font-weight: bold; font-family: var(--font-title); text-align: center; margin: 10px 0; padding: 12px;
    border-radius: var(--border-radius); animation: skillPopup 0.4s ease-out;
    background-color: rgba(106, 171, 125, 0.15); border: 2px solid var(--color-stamina); color: #ffffff; text-shadow: 0 0 5px var(--color-stamina);
}
.log-message.log-skill-monster {
    font-size: 1.1rem; font-weight: bold; font-family: var(--font-title); text-align: center; margin: 10px 0; padding: 10px;
    border-radius: var(--border-radius); animation: skillPopup 0.3s ease-out;
    background-color: rgba(171, 106, 106, 0.15); border: 2px solid var(--color-health); color: #ffffff; text-shadow: 0 0 5px var(--color-health);
}
.log-message.log-critical-hit {
    font-size: 1.2rem; font-weight: bold; font-family: var(--font-title); text-align: center; margin: 10px 0; padding: 12px;
    border-radius: var(--border-radius); animation: skillPopup 0.4s ease-out;
    background-color: rgba(138, 109, 59, 0.15); border: 2px solid var(--color-accent); color: #ffffff; text-shadow: 0 0 5px var(--color-accent);
}

#race-selection { display: block; }
#main-game, #combat-screen { display: none; }
.hidden { display: none !important; }

@media (max-width: 900px) {
    body { overflow-y: auto; }
    #game-container { max-width: 100%; margin: 0; padding: 10px; max-height: none; min-height: 100vh; border: none; border-radius: 0; }
    #main-game { grid-template-areas: "status" "main" "log"; grid-template-columns: 1fr; grid-template-rows: auto 1fr auto; gap: 10px; max-height: none; }
    #main-content { grid-row: auto; max-height: none; min-height: 300px; }
    #status-panel { max-height: 35vh; }
    #log-panel { height: 30vh; }
    .modal-content { width: 95%; max-width: 95%; max-height: 80vh; }
    button { padding: 14px 15px; font-size: 1.05rem; }
    .tile { width: 35px; height: 35px; font-size: 1rem; }

    #main-game.city-map-layout #main-content {
        min-height: 420px;
        max-height: none;
    }
    #main-game.city-map-layout #status-panel,
    #main-game.city-map-layout #log-panel {
        width: min(82vw, 350px);
        top: 56px;
    }
    #main-game.city-map-layout #status-panel { left: 42px; }
    #main-game.city-map-layout #log-panel { right: 42px; }
    .panel-toggle {
        top: 50%;
        transform: translateY(-50%);
        width: 34px;
        min-height: 122px;
        font-size: 0.67rem;
        padding: 8px 4px;
    }
    .panel-toggle-status { left: 4px; }
    .panel-toggle-log { right: 4px; }

    .city-map-body {
        grid-template-columns: 1fr;
        min-height: 0;
    }
    .city-map-viewport {
        min-height: 430px;
    }
    .city-map-node {
        width: 136px;
        min-height: 58px;
        padding: 8px 8px;
    }
    .city-map-node .city-map-node-label {
        font-size: 0.78rem;
    }
    .city-map-node .city-map-node-type {
        font-size: 0.69rem;
    }
    .city-map-node.node-district {
        width: 150px;
    }
    .city-map-quick-actions {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    .city-action-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    .city-shop-layout {
        grid-template-columns: 1fr;
    }
    .city-shop-grid {
        max-height: 280px;
    }
    .character-status-layout {
        grid-template-columns: 1fr;
    }
    .character-slot-list {
        grid-template-columns: 1fr;
    }

    #inventory-screen .modal-content.inventory-rpg-modal {
        width: 98%;
        max-width: 98%;
    }
    .inventory-rpg-layout {
        grid-template-columns: 1fr;
        min-height: 0;
    }
    .inv-item-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
        max-height: 330px;
    }
    .modal-card-grid {
        grid-template-columns: 1fr;
    }
    .status-chip-grid,
    .status-mini-grid {
        grid-template-columns: 1fr;
    }
}
